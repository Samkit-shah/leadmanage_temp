import{g as A,d as z,p as F,r as p,j as e,T as W,P as I,a as D,b as Y,c as C,e as n,A as L,f as x,F as _,h as G,i as $,k as V,l as k,m as q,n as R,o as B,q as N,s as H,R as f,u as M,t as Q,v as U,C as J,G as o,B as w,w as K,x as X,y as Z,z as ee}from"./index-BBusEcbR.js";import{g as te}from"./product-B9DGzYru.js";import{g as se,c as ne}from"./Style--b0mMLJA.js";import{A as ae}from"./index-C7dUZSeJ.js";const re=async r=>{try{const{mappedProducts:a,msg:i}=await A(`productmapping/byoppid/${r}`);return Promise.resolve({mappedProducts:a,msg:i})}catch{return Promise.reject("Something went wrong!")}},ie=async r=>{try{const{msg:a}=await z(`productmapping/${r}`);return Promise.resolve({msg:a})}catch{return Promise.reject("Something went wrong!")}},le=async(r,a)=>{try{const{msg:i}=await F(`productmapping/${r}`,a);return Promise.resolve({msg:i})}catch{return Promise.reject("Something went wrong!")}},ce=async r=>{try{const{msg:a}=await F("productmapping",r);return Promise.resolve({msg:a})}catch{return Promise.reject("Something went wrong!")}};function oe({oppid:r,rows:a,getMappedProducts:i,status:c}){const[d,m]=p.useState([]),[j,y]=p.useState(null),[g,b]=p.useState(null),[u,S]=p.useState(null);function v(t){return t.map(({mrp:s,quantity:l,discount:O})=>s*l-O).reduce((s,l)=>s+l,0)}const h=async()=>{try{if(j)if(g){if(!u)throw new Error("discount value is required!")}else throw new Error("quantity value is required!");else throw new Error("Please Select Product!");const t={product_id:+j.id,quantity:+g,opportinity_id:+r,mrp:j.mrp,discount:u},{msg:s}=await ce(t);alert(s),i(),y(null),b(0),S(0)}catch(t){alert(t)}},T=(t,s)=>{try{const{msg:l}=le(s,{key:t.target.name,value:t.target.value});i()}catch(l){alert(l)}};p.useEffect(()=>{te().then(({products:t,msg:s})=>m(t))},[]);const P=(t,s)=>{s&&y(s)},E=async t=>{try{await ie(t),i()}catch(s){alert(s)}};return e.jsx(W,{component:I,children:e.jsxs(D,{"aria-label":"spanning table",children:[e.jsxs(Y,{children:[c!=="TYFCB"&&c!=="CLOSELOST"&&e.jsxs(C,{children:[e.jsx(n,{width:"250px",children:e.jsx(L,{size:"small",id:"combo-box-demo",options:d,getOptionLabel:t=>`${t.name}`,onChange:P,renderInput:t=>e.jsx(x,{variant:"outlined",name:"leadid",...t,label:"Product",required:!0})})}),e.jsx(n,{align:"center",width:"250px",children:e.jsx(x,{size:"small",autoFocus:!0,margin:"dense",id:"quantity",label:"quantity",type:"number",value:g,onChange:t=>b(t.target.value),variant:"outlined",required:!0})}),e.jsx(n,{align:"center",width:"250px",children:e.jsx(x,{size:"small",autoFocus:!0,margin:"dense",id:"discount",label:"discount",type:"number",value:u,onChange:t=>S(t.target.value),variant:"outlined",required:!0})}),e.jsx(n,{align:"right",children:e.jsx(_,{color:"primary","aria-label":"add",size:"small",style:{float:"right",marginRight:"10px"},onClick:h,children:e.jsx(G,{})})})]}),e.jsxs(C,{children:[e.jsx(n,{children:"Desc"}),e.jsx(n,{align:"center",children:"SKU"}),e.jsx(n,{align:"center",children:"Qty."}),e.jsx(n,{align:"center",children:"Unit Price"}),e.jsx(n,{align:"center",children:"Discount"}),e.jsx(n,{align:"center",children:"Sum"})]})]}),e.jsxs($,{children:[a.map(t=>e.jsxs(C,{children:[e.jsx(n,{children:t.productname}),e.jsx(n,{align:"center",children:t.sku}),e.jsx(n,{align:"center",children:e.jsx(x,{fullWidth:!0,id:"quantity",name:"quantity",variant:"standard",onBlur:s=>T(s,t.id),defaultValue:t.quantity,disabled:!(c!=="TYFCB"&&c!=="CLOSELOST")})}),e.jsx(n,{align:"center",children:t.mrp}),e.jsx(n,{align:"center",children:e.jsx(x,{fullWidth:!0,id:"discount",name:"discount",variant:"standard",onBlur:s=>T(s,t.id),defaultValue:t.discount,disabled:!(c!=="TYFCB"&&c!=="CLOSELOST")})}),e.jsx(n,{align:"center",children:t.quantity*t.mrp-t.discount}),c!=="TYFCB"&&c!=="CLOSELOST"&&e.jsx(n,{align:"center",children:e.jsx(V,{fontSize:"small",onClick:()=>E(t.id)})})]},t.productname)),e.jsxs(C,{children:[e.jsx(n,{rowSpan:3}),e.jsx(n,{colSpan:2,children:"Total"}),e.jsx(n,{align:"right",children:v(a)})]})]})]})})}function de({oppid:r,status:a,rows:i,getMappedProducts:c}){return e.jsx("div",{children:e.jsxs(k,{children:[e.jsx(q,{expandIcon:e.jsx(R,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsxs(B,{style:{fontWeight:"bold",fontSize:"15px"},children:["Products (",i.length,")"]})}),e.jsx(N,{children:e.jsx(oe,{isChild:!0,oppid:r,rows:i,getMappedProducts:c,status:a})})]})})}function ue({opportinityid:r,status:a}){const[i,c]=p.useState([]),d=async()=>{try{const{tasks:m}=await H(r);c(m)}catch(m){alert(m)}};return p.useEffect(()=>{d()},[]),e.jsx("div",{children:e.jsxs(k,{children:[e.jsx(q,{expandIcon:e.jsx(R,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:e.jsxs(B,{style:{fontWeight:"bold",fontSize:"15px"},children:["Tasks (",i.length,")"]})}),e.jsx(N,{children:e.jsx(ae,{data:i,opportinityid:r,getTasks:d,status:a})})]})})}function je(){const[r,a]=f.useState([]),[i,c]=f.useState(0),{id:d}=M(),m=async()=>{try{const{mappedProducts:t}=await re(d);a(t),c(t.map(({mrp:s,quantity:l,discount:O})=>s*l-O).reduce((s,l)=>s+l,0))}catch(t){alert(t)}};f.useEffect(()=>{m()},[]);const j=Q(),[y,g]=p.useState(!1),b=U(I)(({theme:t})=>({backgroundColor:t.palette.mode==="dark"?"#1A2027":"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})),[u,S]=p.useState("INPROGRESS"),v=["INPROGRESS","NEGOTIATION","TYFCB","CLOSELOST"],[h,T]=f.useState(null),P=async()=>{try{const{opportunity:t,msg:s}=await se(d);S(t.status),T(t)}catch(t){alert(typeof t=="string"?t:t.message)}},E=async t=>{try{t.preventDefault();const s=new FormData(t.currentTarget),l=Object.fromEntries(s.entries());l.id=h.id,l.account_id=h.account_id;const{msg:O}=await ne(l);alert("Opportinity updated successfully!"),(l.status==="TYFCB"||l.status==="CLOSELOST")&&j(-2)}catch(s){alert(s)}};return f.useEffect(()=>{P()},[]),e.jsx(e.Fragment,{children:e.jsx(J,{maxWidth:"xl",className:"edit-lead-container",children:e.jsx("div",{children:e.jsxs(o,{container:!0,spacing:6,children:[e.jsx(o,{item:!0,xl:12,lg:12,md:12,xs:12,children:e.jsx(w,{color:"primary",onClick:()=>j(-1),className:"back-button",children:e.jsx(K,{fontSize:"small",fontWeight:"bold",className:"back-button-icon"})})}),e.jsx(o,{item:!0,xl:12,lg:12,md:12,xs:12,children:e.jsx("div",{className:"status-buttons-container",children:v.map(t=>e.jsx(w,{variant:"contained",color:u===t?"warning":"success",className:"status-button",children:t},t))})}),e.jsx(o,{item:!0,xl:6,lg:6,md:6,xs:12,children:e.jsxs(X,{children:[e.jsx(Z,{variant:"h5",className:"lead-status-header",title:"Opportinity Details"}),e.jsx(ee,{children:h&&e.jsxs("form",{onSubmit:E,children:[e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xl:6,xs:12,children:e.jsx(x,{fullWidth:!0,id:"name",name:"name",label:"Opproutinity Name",variant:"outlined",defaultValue:h.name})}),e.jsx(o,{item:!0,xl:6,xs:12,children:e.jsx(x,{fullWidth:!0,id:"description",name:"description",label:"Description",variant:"outlined",defaultValue:h.description})})]}),e.jsx("br",{}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xl:6,xs:12,children:e.jsx(L,{fullWidth:!0,size:"small",id:"combo-box-demo",defaultValue:h.status,options:[{label:"INPROGRESS"},{label:"NEGOTIATION"},{label:"TYFCB"},{label:"CLOSELOST"}],renderInput:t=>e.jsx(x,{variant:"outlined",name:"status",...t,label:"Status"})})}),e.jsx("br",{}),e.jsx(o,{item:!0,xl:6,xs:12,children:e.jsx(x,{fullWidth:!0,id:"total",name:"total",label:"Total",variant:"outlined",defaultValue:i,disabled:!0})})]}),e.jsx("br",{}),e.jsx("br",{}),u!=="TYFCB"&&u!=="CLOSELOST"?e.jsx(w,{type:"submit",variant:"contained",color:"success",children:"Save Changes"}):"",e.jsx("br",{}),e.jsx("br",{})]})})]})}),e.jsx(o,{item:!0,xl:6,lg:6,md:6,xs:12,children:e.jsxs(b,{children:[e.jsx(ue,{open:y,setOpen:g,opportinityid:d,status:u}),e.jsx("br",{}),e.jsx(de,{open:y,setOpen:g,oppid:d,status:u,rows:r,getMappedProducts:m}),e.jsx("br",{})]})})]})})})})}export{je as default};
